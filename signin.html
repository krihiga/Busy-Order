<!DOCTYPE html>
<html lang="en">
<head>
	<title>Busy Order</title>
    <link rel="stylesheet" href="style.css">
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">



<script src="script.js"></script>
</head>
<body class="signin-body">
	 <!--Nav Bar Start-->
     <nav class="navbar">
        <a href="index.html">
            <img id="Logo" class="logo" src="img/busy order.png" alt="logo" >
        </a>
    <ul>
        <li><a href="index.html" id="homeLink">Home</a></li>
        <li><a href="#" id="sersec" onclick="goToServiceSection()">Services</a></li>
        <li><a href="#"id="blogsec" onclick="goToBlogSection()">Blog</a></li>
        <li><a href="#"id="contsec" onclick="goToContactSection()">Contact Us</a></li>
        <li><a href="#"id="aboutsec" onclick="goToAboutSection()">About</a></li>
    </ul>
    </nav> 
    <!--Nav Bar End-->
    <section class="signin-section" id="signin-section">
        <div class="signin-container">
            <h2>Sign In</h2>
					<!-- Mobile Number Sign-In -->
                    <div id="maildiv" class="wrap-input100 validate-input" data-validate = "Valid email is: a@b.c">
                        <form class="signin-form" id="signin" method="post">
                          <input type="text" class="username" id="username" name="username" placeholder="UserName" required>
                            <input type="email" class="email" id="email" name="email" placeholder="xyz@gmail.com" required>
                            <input type="password" class="password" id="password" name="password" placeholder="Enter your Password" required>
                            <input type="file" id="profilePic" name="profilePic" accept="image/*" required>
                            <button type="submit" class="signin-btn">Create New User</button>
                            <a href="login.html"> <button type="button" class="signin-btn">Sign In</button></a>
                        </form>
                </div>
        </div>
    </section>
    <script type="module">
        // Import the functions you need from the SDKs
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-storage.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyDVIaFaHV5e4fxL6HQeO22_TtaGEtK60CE",
  authDomain: "busy-order-111094.firebaseapp.com",
  databaseURL: "https://busy-order-111094-default-rtdb.firebaseio.com",
  projectId: "busy-order-111094",
  storageBucket: "busy-order-111094.firebasestorage.app",
  messagingSenderId: "402345046681",
  appId: "1:402345046681:web:4def93c2d5c4742b3c7e08",
  measurementId: "G-3R9FT0HKNM"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app); // Pass `app` to initialize the database correctly
const auth = getAuth(app);
const storage = getStorage(app);


// Get form elements
let Email = document.getElementById('email');
let Password = document.getElementById('password'); // Ensure there are no trailing spaces in the ID
let signinForm = document.getElementById('signin');
let ProfilePic = document.getElementById('profilePic');


let RegisterUser = async (evt) => {
  evt.preventDefault();

  if (Email.value && Password.value && ProfilePic.files[0]) {
    try {
      // Create user with email and password
      const userCredential = await createUserWithEmailAndPassword(auth, Email.value, Password.value);
      const user = userCredential.user;

      // Upload profile picture to Firebase Storage
      const file = ProfilePic.files[0];
      const storagePath = `profile-pictures/${user.uid}/${file.name}`;
      const fileRef = storageRef(storage, storagePath);
      await uploadBytes(fileRef, file);

      // Get the download URL of the uploaded file
      const profilePicURL = await getDownloadURL(fileRef);

      // Save user data to the Realtime Database
      await set(ref(db, 'users/' + user.uid), {
        username: username.value,
        email: Email.value,
        profilePicture: profilePicURL, // Save the correct URL here
        createdAt: new Date().toISOString()
      });

      alert('User successfully created and saved to the database!');
      window.location.href = 'login.html';

    } catch (error) {
      console.error('Error:', error);
      alert('Error: ' + error.message);
    }
  } else {
    alert('Please fill in all fields and upload a profile picture.');
  }
};


// Attach event listener to the form
signinForm.addEventListener('submit', RegisterUser);

    </script>
</body>
</html>